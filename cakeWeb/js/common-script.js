// console.log('Hellos');

const data = [
    {
         bgImage: "./images/1.jpg",
         id: 1,
         color: "#222",
     //     font: "Ballet, cursive"
         font: "Montserrat, sans-serif"
     },
    {
         bgImage: "./images/2.jpg",
         id: 2,
         color: "#222",
         font: "PT Sans, sans-serif"
    },
    {
         bgImage: "./images/3.jpg",
         id: 3,
         color: "#222",
         font: "Montserrat, sans-serif"
    },
    {
         bgImage: "./images/4.jpg",
         id: 4,
         color: "#fff",
     //     font: "Roboto, sans-serif"
         font: "Ballet, cursive"
    },
    {
         bgImage: "./images/5.jpg",
         id: 5,
         color: "#fff",
         font: "Roboto, sans-serif"
     //     font: "Montez, cursive"
    },
    {
         bgImage: "./images/6.jpg",
         id: 6,
         color: "#fff",
         font: "Bad Script, cursive"
    },
    {
         bgImage: "./images/7.jpg",
         id: 7,
         color: "#fff",
         font: "Damion, cursive"
    },
    {
         bgImage: "./images/8.jpg",
         id: 8,
         color: "#fff",
     //     font: "Dancing Script, cursive"
         font: "Roboto, sans-serif"
    },
    {
         bgImage: "./images/9.jpg",
         id: 9,
         color: "#fff",
         font: "Dancing Script, cursive"
    },
    {
         bgImage: "./images/10.jpg",
         id: 10,
         color: "#fff",
         font: "Dancing Script, cursive"
    },
    {
         bgImage: "./images/11.jpg",
         id: 11,
         color: "#fff",
         font: "Roboto, sans-serif"
    },
    {
         bgImage: "./images/12.jpg",
         id: 12,
         color: "#fff",
         font: "Pacifico, cursive"
    },
    {
         bgImage: "./images/13.jpg",
         id: 13,
         color: "#222",
         font: "Sacramento, cursive"
    },
    {
         bgImage: "./images/14.jpg",
         id: 14,
         color: "#fff",
         font: "Satisfy, cursive"
    },
    {
         bgImage: "./images/15.jpg",
         id: 15,
         color: "#fff",
         font: "Dancing Script, cursive"
    },
    {
         bgImage: "./images/16.jpg",
         id: 16,
         color: "#fff",
         font: "Great Vibes, cursive"
    },
    {
         bgImage: "./images/17.jpg",
         id: 17,
         color: "#fff",
         font: "Great Vibes, cursive"
    },
    {
         bgImage: "./images/18.jpg",
         id: 18,
         color: "#fff",
         font: "Great Vibes, cursive"
    },
    {
         bgImage: "./images/19.jpg",
         id: 19,
         color: "#222",
         font: "Roboto, sans-serif"
    },
    {
         bgImage: "./images/20.jpg",
         id: 20,
         color: "#fff",
         font: "Great Vibes, cursive"
    },
    {
         bgImage: "./images/21.jpg",
         id: 21,
         color: "#222",
         font: "Great Vibes, cursive"
    },
    {
         bgImage: "./images/22.jpg",
         id: 22,
         color: "#222",
         font: "Montserrat, sans-serif"
    },
    {
         bgImage: "./images/23.jpg",
         id: 23,
         color: "#222",
         font: "Montserrat, sans-serif"
    },
    {
         bgImage: "./images/24.jpg",
         id: 24,
         color: "#222",
         font: "Pacifico, cursive"
    },
    {
         bgImage: "./images/25.jpg",
         id: 25,
         color: "#222",
         font: "Montserrat, sans-serif"
    },
    {
         bgImage: "./images/26.jpg",
         id: 26,
         color: "#fff",
         font: "Six Caps, sans-serif"
    },
    {
         bgImage: "./images/27.jpg",
         id: 27,
         color: "#fff",
         font: "Montserrat, sans-serif"
    },
    {
         bgImage: "./images/28.jpg",
         id: 28,
         color: "#222",
         font: "Montserrat, sans-serif"
    },
    {
         bgImage: "./images/29.jpg",
         id: 29,
         color: "#fff",
         font: "Montserrat, sans-serif"
    },
    {
         bgImage: "./images/30.jpg",
         id: 30,
         color: "#fff",
         font: "Great Vibes, cursive"
    },
    {
         bgImage: "./images/31.jpg",
         id: 31,
         color: "#fff",
         font: "Montserrat, sans-serif"
    },
    {
         bgImage: "./images/32.jpg",
         id: 32,
         color: "#222",
         font: "Montserrat, sans-serif"
    },
    {
         bgImage: "./images/33.jpg",
         id: 33,
         color: "#222",
         font: "Montserrat, sans-serif"
    },
    {
         bgImage: "./images/34.jpg",
         id: 34,
         color: "#222",
         font: "Great Vibes, cursive"
    },
    {
         bgImage: "./images/35.jpg",
         id: 35,
         color: "#222",
         font: "Great Vibes, cursive"
    },
    {
         bgImage: "./images/36.jpg",
         id: 36,
         color: "#fff",
         font: "Ballet, cursive"
    },
    {
         bgImage: "./images/37.jpg",
         id: 37,
         color: "#fff",
         font: "Ballet, cursive"
    },
    {
         bgImage: "./images/38.jpg",
         id: 38,
         color: "#fff",
         font: "Ballet, cursive"
    },
    {
         bgImage: "./images/39.jpg",
         id: 39,
         color: "#fff",
         font: "Pacifico, cursive"
    },
    {
         bgImage: "./images/40.jpg",
         id: 40,
         color: "#222",
         font: "Montserrat, sans-serif"
    },
    {
         bgImage: "./images/41.jpg",
         id: 41,
         color: "#fff",
         font: "Six Caps, sans-serif"
    },
    {
         bgImage: "./images/42.jpg",
         id: 42,
         color: "#fff",
         font: "Montserrat, sans-serif"
    },
    {
         bgImage: "./images/43.jpg",
         id: 43,
         color: "#222",
         font: "Original Surfer, cursive"
    },
    {
         bgImage: "./images/44.jpg",
         id: 44,
         color: "#fff",
         font: "Montserrat, sans-serif"
    },
    {
         bgImage: "./images/45.jpg",
         id: 45,
         color: "#fff",
         font: "Original Surfer, cursive"
    },
    {
         bgImage: "./images/46.jpg",
         id: 46,
         color: "#fff",
         font: "Pacifico, cursive"
    },
    {
         bgImage: "./images/47.jpg",
         id: 47,
         color: "#fff",
         font: "Great Vibes, cursive"
    },
    {
         bgImage: "./images/48.jpg",
         id: 48,
         color: "#fff",
         font: "Montserrat, sans-serif"
    },
    {
         bgImage: "./images/49.jpg",
         id: 49,
         color: "#222",
         font: "Roboto, sans-serif"
    },
    {
         bgImage: "./images/50.jpg",
         id: 50,
         color: "#222",
         font: "Roboto, sans-serif"
    },
];
let theCOntainer = document.getElementById('theRowForCols');
data.map(canva => {
    // console.log(canva)
    let theCol = document.createElement('div');
    theCol.className = 'col-md-4 col-xl-3 thecard-col';
    theCol.innerHTML = `<div class="inside-card-col">
                            <div class="image-container">
                                <img src="${canva.bgImage}" alt="" loading="lazy">
                                <div class="namesection" style="font-family: ${canva.font}; color: ${canva.color}"></div>
                            </div>
                            <div class="buttonforpagehandel">
                            
                                <button class="btn downloadbtn" onclick='download("${canva.bgImage}", "${canva.color}", ${canva.id}, "${canva.font}", this)'><div class=" d-none spinner-border  theButtonspinner" id="spinner${canva.id}"></div>Download</button>
                                <button class="btn downloadbtn " onclick='shareSave("${canva.bgImage}", "${canva.color}", ${canva.id}, "${canva.font}", this)'><div class=" d-none spinner-border  theButtonspinner" id="spinnerShare${canva.id}"></div>Share</button>
                            </div>
                        </div>`
    theCOntainer.appendChild(theCol);
})

let canvas = null;
let CurvedText = ""
$(function () {
    canvas = new fabric.Canvas('can');

    canvas.setHeight(1080);
    canvas.setWidth(1080);
    var img_src = './card1.jpg';
    var img = new Image();
    img.src = img_src;
    img.crossOrigin = "anonymous";  // important - set crossOrigin before src!
    img.onload = function(){
        canvas.setBackgroundImage(new fabric.Image(img, {
            width: canvas.width,
        height: canvas.height,
            originX: 'left',
            originY: 'top'
        }), canvas.renderAll.bind(canvas));
    };
    canvas.setZoom(canvas.getZoom() *1.0);
    
    CurvedText = new fabric.CurvedText($('#forCommorName').val(),{
                left: 540,
                top: 940,
                textAlign: 'center',
                fill: '#222',
                radius: 100,
                fontSize: 60,
                spacing: 7,
                effect:'STRAIGHT',
                fontFamily: '"Montez", cursive', 
                hasControls: false,
                originX: "center",

    });
    
    canvas.add(CurvedText).renderAll();
    canvas.setActiveObject(canvas.item(canvas.getObjects().length-1));
    // $('#effect').change(function(){
    //         var obj = canvas.getActiveObject();

    //         if(obj){
    //             obj.set($(this).attr('id'),$(this).val()); 
    //         }
    //         canvas.renderAll();
    //     });
    // $('#fontFamily').change(function(){
    //         var obj = canvas.getActiveObject();
    //         if(obj){
    //             obj.set($(this).attr('id'),$(this).val()); 
    //         }
    //         canvas.renderAll();
    //     });
    
});

function updateUserName(val){
    let text = val.value;
    // console.log(val)
    if(text.length < 18){

        $('.namesection').text(text);
    };
    CurvedText.setText(text);
    canvas.renderAll()
};
function download(bg, color, id, font, val){

    // canvas = new fabric.Canvas('can');
    let cakeName = $('#forCommorName').val();
    
    let ele = document.getElementById('spinner' + id);
    ele.classList.remove("d-none");
    // console.log(val.children)
    async function lol()  {
        canvas.setHeight(1080);
        canvas.setWidth(1080);
        var img_src = bg;
        var img = new Image();
        img.src = img_src;
        img.crossOrigin = "anonymous";  // important - set crossOrigin before src!
        img.onload = function(){
            canvas.setBackgroundImage(new fabric.Image(img, {
                width: canvas.width,
            height: canvas.height,
                originX: 'left',
                originY: 'top'
            }), canvas.renderAll.bind(canvas));
        };
        canvas.setZoom(canvas.getZoom() *1.0);
        // let CurvedText2 = new fabric.CurvedText('',{
        //     left: 200,
        //     top: 300,
        //     textAlign: 'center',
        //     fill: color,
        //     radius: 100,
        //     fontSize: 30,
        //     spacing: 7,
        //     effect:'STRAIGHT',
        //     fontFamily: '"Montez", cursive', 
        //     hasControls: false,
        //     originX: "center",

        // });
        CurvedText.setText($('#forCommorName').val());
        CurvedText.set({'fontFamily': font, fill: color});
        canvas.add(CurvedText).renderAll(function(){
            
        });
        // canvas.setActiveObject(canvas.item(canvas.getObjects().length-1));
        canvas.deactivateAll();
        canvas.renderAll();
        return canvas;

    }
    lol()
    .then((canvas) => {
        setTimeout(() => {
            if(cakeName.length < 1) cakeName = "yourCake";
            var link = document.createElement('a');
            link.download = cakeName + '.png';
            link.href = document.getElementById('can').toDataURL('image/png')
            link.click();
            ele.classList.add("d-none");
        }, 3000)
    })
  
}
function shareSave(bg, color, id, font, val){


    let cakeName = $('#forCommorName').val();
    
    let ele = document.getElementById('spinnerShare' + id);
    ele.classList.remove("d-none");
    // console.log(val.children)
    async function lol()  {
        // canvas.setHeight(400);
        // canvas.setWidth(400);
        var img_src = bg;
        var img = new Image();
        img.src = img_src;
        img.crossOrigin = "anonymous";  // important - set crossOrigin before src!
        img.onload = function(){
            canvas.setBackgroundImage(new fabric.Image(img, {
                width: canvas.width,
            height: canvas.height,
                originX: 'left',
                originY: 'top'
            }), canvas.renderAll.bind(canvas));
        };
        canvas.setZoom(canvas.getZoom() *1.0);
        // CurvedText = new fabric.CurvedText('',{
        //     left: 200,
        //     top: 300,
        //     textAlign: 'center',
        //     fill: color,
        //     radius: 100,
        //     fontSize: 30,
        //     spacing: 7,
        //     effect:'STRAIGHT',
        //     fontFamily: '"Montez", cursive', 
        //     hasControls: false,
        //     originX: "center",

        // });
        CurvedText.setText($('#forCommorName').val());
        CurvedText.set({'fontFamily': font, 'fill': color});
        canvas.add(CurvedText).renderAll(function(){
            
        });
        // canvas.setActiveObject(canvas.item(canvas.getObjects().length-1));
        canvas.deactivateAll();
        canvas.renderAll();
        return canvas;

    }
    lol()
    .then((canvas) => {
        setTimeout(() => {
            let theCanv = document.getElementById('can');
            if(cakeName.length < 1) cakeName = "yourCake";
            theCanv.toBlob((blob) => {
            let file = new File([blob], cakeName + ".jpeg", { type: "image/jpeg" });

            var formData = new FormData()
            
            formData.append('file', file);
            $.ajax({
                data: formData,
                type: "POST",
                // dataType: "JSON",
                url: './post.php',
                processData: false,
                contentType: false,
                complete: function (e) {

                            // progressElem.html("");
                            console.log("completed")
                            console.log(e)
                            
                            
                        },
                        success: function(e){
                            console.log(e)
                            let response = JSON.parse(e)
                            console.log(JSON.parse(e))
                            console.log(response)
                            if(response.message.toLowerCase() == 'success'){
                                //  alert('Successful')
                                ele.classList.add("d-none");
                                console.log(response.FileName);
                                $('#whatsappShare').attr('href', "whatsapp://send?text=https://wisheswithname.com/" + response.htmllink);
                                $('#fbShare').attr('href', "https://www.facebook.com/sharer/sharer.php?u=https://wisheswithname.com/" + response.htmllink);
                                $('#theShareButtons').modal('show')
                                // window.location.href = response.htmllink;
                            }else {
                                alert('sorry there is an error.')
                                ele.classList.add("d-none");
                            }
                            // if(e.message.toLowerCase().includes('success') ) 
                            // {
                                // alert('Successful')
                                // ele.classList.add("d-none");
                            // }
                            
                        }
            });
        
            }, 'image/jpeg');
        }, 3000)
    })
  
}
// $('#theShareButtons').modal('show')